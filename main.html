<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SkillConnect</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  /* Reset & base */
  * {margin:0; padding:0; box-sizing:border-box; font-family:'Inter', sans-serif;}
  body {background:#f5f6fa; color:#1e1e2f; transition:0.3s;}
  h2,h3 {color:#1e1e2f; margin-bottom:10px;}
  button {cursor:pointer; border:none; outline:none; transition: all 0.2s;}
  input, textarea {padding:8px 12px; border-radius:6px; border:1px solid #ccc; width:100%; margin-bottom:10px;}
  textarea {resize:none;}
  .primary {background:#1e90ff; color:white; padding:8px 16px; border-radius:8px; font-weight:600;}
  .primary:hover {background:#0f7ae5;}

  /* Sidebar */
  .sidebar {position:fixed; left:0; top:0; width:220px; height:100%; background:#1e1e2f; display:flex; flex-direction:column; align-items:center; padding-top:20px;}
  .logo {font-size:1.6rem; font-weight:700; margin-bottom:30px; color:white;}
  .nav-btn {width:90%; margin:5px 0; padding:10px; border-radius:8px; background:transparent; color:white; text-align:left;}
  .nav-btn.active, .nav-btn:hover {background:#2f2f4d;}

  /* Main content */
  .main {margin-left:220px; padding:20px;}
  .topbar {display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;}
  .controls button {margin-left:10px; padding:6px 10px; border-radius:6px; background:#1e90ff; color:white;}
  .controls button:hover {background:#0f7ae5;}

  /* Sections */
  .section {background:white; border-radius:10px; padding:20px; margin-bottom:20px; box-shadow:0 4px 12px rgba(0,0,0,0.05);}
  .section-header {display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;}

  /* Posts */
  .post-card {background:#fdfdfd; padding:15px; border-radius:8px; margin-bottom:15px; box-shadow:0 2px 8px rgba(0,0,0,0.05); position:relative;}
  .post-card h4 {margin-bottom:5px;}
  .post-card p {font-size:0.9rem; color:#555;}
  .like-btn {position:absolute; top:10px; right:10px; cursor:pointer; font-size:1.2rem; color:#ff4b5c;}
  .like-btn.liked {color:#e63946;}

  /* Modal */
  .modal {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:100;}
  .modal-content {background:white; padding:20px; border-radius:10px; width:90%; max-width:400px; animation:fadeIn 0.3s;}
  @keyframes fadeIn {from{opacity:0;transform:translateY(-20px);} to{opacity:1; transform:translateY(0);}}

  /* Profile */
  #profile-pic {border-radius:50%; width:80px; height:80px; margin-bottom:10px; object-fit:cover;}

  /* Toast notification */
  #toast {position:fixed; bottom:20px; right:20px; background:#1e90ff; color:white; padding:12px 20px; border-radius:8px; display:none; box-shadow:0 4px 12px rgba(0,0,0,0.2);}

  /* Dark mode */
  body.dark {background:#121212; color:#eee;}
  body.dark .main {color:#eee;}
  body.dark .section {background:#1f1f2f;}
  body.dark input, body.dark textarea {background:#2a2a3d; color:#eee; border:1px solid #444;}
  body.dark .sidebar {background:#1e1e2f;}
  body.dark .primary {background:#0f7ae5;}
  body.dark .primary:hover {background:#0d6acc;}
</style>
</head>

<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo">SkillConnect</div>
    <button class="nav-btn active" id="nav-feed">Discover</button>
    <button class="nav-btn" id="nav-map">Map</button>
    <button class="nav-btn" id="nav-messages">Messages</button>
    <button class="nav-btn" id="nav-profile">Profile</button>
  </div>

  <!-- Main -->
  <div class="main">
    <div class="topbar">
      <div id="user-email-top"></div>
      <div class="controls">
        <button id="dark-toggle">ðŸŒ™</button>
        <button id="logout-btn" style="display:none;">Logout</button>
      </div>
    </div>

    <!-- FEED SECTION -->
    <div class="section" id="feed-section">
      <div class="section-header">
        <h2>People near you sharing their skills</h2>
        <div style="display:flex; gap:10px;">
          <input type="text" id="search-posts" placeholder="Search skill or location">
          <button class="primary" id="openModalBtn">Share Skill</button>
        </div>
      </div>
      <div id="posts"></div>
    </div>

    <!-- MAP SECTION -->
    <div class="section" id="map-section" style="display:none;">
      <h2>Nearby Skilled Users</h2>
      <div id="map" style="width:100%;height:420px;border-radius:10px;margin-top:10px;"></div>
    </div>

    <!-- MESSAGES -->
    <div class="section" id="dm-section" style="display:none;">
      <h2>Messages</h2>
      <input type="text" id="dm-to" placeholder="Recipient email">
      <input type="text" id="dm-msg" placeholder="Message">
      <button class="primary" id="send-dm-btn">Send</button>
      <div id="dm-messages" style="max-height:220px;overflow:auto;"></div>
    </div>

    <!-- PROFILE -->
    <div class="section" id="profile-section" style="display:none;">
      <h2>Your Profile</h2>
      <img src="https://via.placeholder.com/80" id="profile-pic">
      <input type="file" id="profile-upload">
      <button class="primary" id="upload-pic-btn">Upload</button>

      <hr style="margin:20px 0;border:none;border-top:1px solid #ddd;">

      <h3>Your Shared Skills <span id="post-count" style="font-weight:400;color:#555;"></span></h3>
      <div id="your-posts" style="max-height:300px;overflow-y:auto;"></div>
    </div>
  </div>

  <!-- POST MODAL -->
  <div id="postModal" class="modal">
    <div class="modal-content">
      <h3>Share Your Skill</h3>
      <input type="text" id="skill" placeholder="Skill (e.g., Web Design)">
      <input type="text" id="location" placeholder="Location">
      <input type="text" id="experience" placeholder="Experience (e.g., 2 years)">
      <textarea id="description" placeholder="Describe your skill..."></textarea>
      <button class="primary" id="post-btn">Publish</button>
    </div>
  </div>

  <!-- LOGIN POPUP -->
  <div id="loginPopup" class="modal">
    <div class="modal-content">
      <h2>Welcome to SkillConnect</h2>
      <p style="font-size:0.9rem;color:#555;margin-bottom:10px;">Log in or sign up to share your skills.</p>
      <input type="email" id="email" placeholder="Email">
      <input type="password" id="password" placeholder="Password">
      <button class="primary" id="signup-btn">Sign Up</button>
      <button class="primary" id="login-btn">Login</button>
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast">New post shared!</div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

  <!-- Your app scripts -->
  <script src="js/app.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/posts.js"></script>
  <script src="js/profile.js"></script>
  <script src="js/chat.js"></script>
  <script src="js/map.js"></script>

  <script>
    // Dark mode toggle
    const darkToggle = document.getElementById('dark-toggle');
    darkToggle.addEventListener('click', ()=>{
      document.body.classList.toggle('dark');
    });

    // Sidebar navigation
    const sections = ['feed','map','messages','profile'];
    const navBtns = sections.map(s=>document.getElementById('nav-'+s));
    navBtns.forEach((btn,i)=>{
      btn.addEventListener('click',()=>{
        navBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        sections.forEach(s=>document.getElementById(s+'-section').style.display='none');
        document.getElementById(sections[i]+'-section').style.display='block';
      });
    });

    // Modal logic
    const postModal = document.getElementById('postModal');
    document.getElementById('openModalBtn').onclick=()=> postModal.style.display='flex';
    window.onclick = e=>{ if(e.target==postModal) postModal.style.display='none'; }

    // Post search/filter
    const searchInput = document.getElementById('search-posts');
    searchInput.addEventListener('input', ()=>{
      const query = searchInput.value.toLowerCase();
      const posts = document.querySelectorAll('.post-card');
      posts.forEach(post=>{
        const skill = post.dataset.skill.toLowerCase();
        const loc = post.dataset.location.toLowerCase();
        post.style.display = skill.includes(query) || loc.includes(query) ? 'block' : 'none';
      });
    });

    // Like button logic
    document.addEventListener('click', e=>{
      if(e.target.classList.contains('like-btn')){
        e.target.classList.toggle('liked');
      }
    });

    // Toast notification
    function showToast(msg){
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.style.display='block';
      setTimeout(()=>toast.style.display='none',3000);
    }

    // Confetti for new post
    function celebratePost(){
      confetti({particleCount:80, spread:60, origin:{y:0.6}});
    }
  </script>
</body>
</html>
